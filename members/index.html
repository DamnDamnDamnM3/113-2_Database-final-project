<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>系所成員</title>
    <link rel="icon" href="/~D1210799/pics/iecs_logo.png" type="image/png" />
    <script src="/~D1210799/js/config.js"></script>
    <link rel="stylesheet" href="/~D1210799/members/members.css">
</head>

<body>
    <div id="header-include"></div>
    <main class="content">
        <!-- 左側選單 -->
        <nav class="sidebar">
            <h2>系所成員</h2>
            <a href="chairman">系主任</a>
            <a href="honorary">榮譽特聘教授</a>
            <a href="chair">講座教授</a>
            <a href="distinguished_chair">特約教授</a>
            <a href="distinguished">特聘教授</a>
            <a href="full_time">專任教授</a>
            <a href="part_time">兼任教授</a>
            <a href="staff">行政人員</a>
            <a href="retired">退休教授</a>
        </nav>
        <!-- 右側成員卡片區，這裡示範放三排共九位成員卡 -->
        <section class="card-list" id="member-card-list">
            <!-- 卡片將由 JS 動態產生 -->
        </section>
    </main>
    <div id="footer-include"></div>
    <script>
        function fixBasePathForLinksAndImages(container) {
            if (typeof BASE_PATH === 'undefined') return;
            container.querySelectorAll('a').forEach(link => {
                const href = link.getAttribute('href');
                if (href && href.startsWith('/') && !href.startsWith(BASE_PATH)) {
                    link.setAttribute('href', BASE_PATH + href);
                }
            });
            container.querySelectorAll('img').forEach(img => {
                const src = img.getAttribute('src');
                if (src && src.startsWith('/') && !src.startsWith(BASE_PATH)) {
                    img.setAttribute('src', BASE_PATH + src);
                }
            });
        }
        function includeHTML(id, file) {
            if (typeof BASE_PATH === 'undefined') return;
            fetch(BASE_PATH + '/' + file).then(res => res.text()).then(html => {
                const container = document.getElementById(id);
                container.innerHTML = html;
                fixBasePathForLinksAndImages(container);
            });
        }
        includeHTML('header-include', 'header.html');
        includeHTML('footer-include', 'footer.html');
    </script>
    <script>
        const membersLink = document.getElementById('members-link');
        const navItems = document.querySelectorAll('.nav-item');
        navItems.forEach(item => {
            if (item !== membersLink) {
                item.addEventListener('mouseenter', () => {
                    membersLink.classList.remove('active');
                });
                item.addEventListener('mouseleave', () => {
                    membersLink.classList.add('active');
                });
            }
        });
    </script>
    <script>
        async function loadMembers() {
            const list = document.getElementById('member-card-list');
            list.innerHTML = '載入中...';
            try {
                const res = await fetch('/~D1210799/members/api.php');
                const data = await res.json();
                if (!data.success) throw new Error(data.message);
                let html = '';
                // 教授卡片
                data.professors.forEach(prof => {
                    html += `
                    <a class="card" href="#" title="${prof.name}">
                        <img src="pics/${prof.photo || 'default.jpg'}" alt="${prof.name}" />
                        <div class="card-content">
                            <h3>${prof.name}</h3>
                            ${prof.type ? `<p>${prof.type}</p>` : ''}
                            ${(prof.expertise && prof.expertise.length) ? `<p>專長：${prof.expertise.join('、')}</p>` : ''}
                            ${prof.email ? `<p>信箱：${prof.email}</p>` : ''}
                        </div>
                    </a>`;
                });
                // 行政人員卡片
                data.staff.forEach(staff => {
                    html += `
                    <a class="card" href="#" title="${staff.name}">
                        <img src="pics/${staff.photo || 'default.jpg'}" alt="${staff.name}" />
                        <div class="card-content">
                            <h3>${staff.name}</h3>
                            ${staff.position ? `<p>${staff.position}</p>` : ''}
                            ${staff.extension ? `<p>分機：${staff.extension}</p>` : ''}
                            ${staff.task_name ? `<p>業務：${staff.task_name}</p>` : ''}
                            ${staff.email ? `<p>信箱：${staff.email}</p>` : ''}
                        </div>
                    </a>`;
                });
                list.innerHTML = html;
            } catch (e) {
                list.innerHTML = '載入失敗：' + e.message;
            }
        }
        loadMembers();
    </script>
</body>

</html>